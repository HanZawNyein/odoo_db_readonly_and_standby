# Global settings for HAProxy
global
    log 127.0.0.1   local0
    maxconn 2000

# Default settings for all frontend/backends
defaults
    log     global
    option  tcplog
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

# Frontend for PostgreSQL clients
frontend pgsql_front
    bind *:5432
    default_backend pgsql_primary

# Backend for primary PostgreSQL database
backend pgsql_primary
    mode tcp
    option  tcp-check
    server db_primary db_primary:5432 check

# Backend for standby PostgreSQL database (used if the primary fails)
backend pgsql_standby
    mode tcp
    option  tcp-check
    server db_standby db_standby:5432 check

# Backend for read-only PostgreSQL database (used for reporting)
backend pgsql_readonly
    mode tcp
    option  tcp-check
    server db_readonly db_readonly:5432 check

# Failover routing between primary and standby
backend pgsql_failover
    mode tcp
    option  tcp-check
    server db_primary db_primary:5432 check
    server db_standby db_standby:5432 backup check

# Routing for reporting via read-only replica
backend pgsql_reporting
    mode tcp
    option  tcp-check
    server db_readonly db_readonly:5432 check
